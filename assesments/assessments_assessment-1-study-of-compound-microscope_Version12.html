<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Assessment: Study of Compound Microscope</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: #f3e5f5; margin: 0;}
    header { text-align: center; padding: 2rem 1rem 1rem 1rem;}
    h1 { color: #6a1b9a; }
    .container { max-width: 800px; margin: 2rem auto; background: #fff; border-radius: 16px; padding: 2rem; box-shadow: 0 2px 8px #ce93d8;}
    .question { margin-bottom: 1.5em;}
    .student-info label { display: block; margin: 0.5em 0 0.2em;}
    .student-info input { width: 100%; padding: 0.5em; margin-bottom: 1em;}
    .declaration { margin: 2em 0 1em 0; }
    .submit-btn { padding: 0.8em 2em; font-size: 1.1em; border: none; background: #6a1b9a; color: #fff; border-radius: 5px;}
    .submit-btn:disabled { background: #b39ddb; }
    .result { font-size: 1.3em; color: #388e3c; margin-top: 2em;}
    .error { color: #d32f2f; margin-bottom: 1em;}
    @media (max-width: 600px) { .container { padding: 1rem; } }
  </style>
</head>
<body>
  <header>
    <h1>Assessment: Study of Compound Microscope</h1>
    <nav>
      <a href="../index.html">Home</a>
      <a href="../experiments.html">Experiments</a>
      <a href="../assessments.html">Assessments</a>
      <a href="../references.html">References</a>
    </nav>
  </header>
  <div class="container">
    <form id="assessmentForm" autocomplete="off">
      <div class="student-info">
        <h2>Student Information</h2>
        <label for="studentName">Student Name*</label>
        <input type="text" id="studentName" name="studentName" required>
        <label for="schoolName">School Name*</label>
        <input type="text" id="schoolName" name="schoolName" required>
        <label for="prnNumber">PRN Number*</label>
        <input type="text" id="prnNumber" name="prnNumber" required>
        <label for="batchNumber">Batch Number*</label>
        <input type="text" id="batchNumber" name="batchNumber" required>
        <label for="emailId">Email ID* (add your institutional email id)</label>
        <input type="email" id="emailId" name="emailId" required>
      </div>
      <hr>
      <div id="questionsSection"></div>
      <div class="declaration">
        <input type="checkbox" id="declaration" required>
        <label for="declaration">
          I hereby declare that this assessment is for my own progress and benefit. All answers submitted are my own and not generated by AI or provided by friends.
        </label>
      </div>
      <button type="submit" class="submit-btn" id="submitBtn">Submit</button>
      <div class="error" id="errorMsg"></div>
      <div class="result" id="resultMsg"></div>
    </form>
  </div>
  <script>
    // --------- Assessment Questions Data (customize per assessment) ---------
    const questions = [
      {
        type: "mcq",
        text: "1. Which part of the compound microscope connects the base to the body tube?",
        options: ["Arm", "Stage", "Pillar", "Draw tube"],
        answer: "Arm"
      },
      {
        type: "mcq",
        text: "2. The function of the diaphragm in a compound microscope is to:",
        options: [
          "Magnify the image",
          "Adjust the amount of light passing through the specimen",
          "Hold the slide in place",
          "Focus the image"
        ],
        answer: "Adjust the amount of light passing through the specimen"
      },
      {
        type: "mcq",
        text: "3. Which lens offers the highest magnification in a compound microscope?",
        options: [
          "Low power objective",
          "High power objective",
          "Oil immersion objective",
          "Eyepiece lens"
        ],
        answer: "Oil immersion objective"
      },
      {
        type: "mcq",
        text: "4. Which adjustment knob is used for precise focusing?",
        options: [
          "Coarse adjustment",
          "Fine adjustment",
          "Stage adjustment",
          "Condenser adjustment"
        ],
        answer: "Fine adjustment"
      },
      {
        type: "short",
        text: "5. Name the lens through which you observe the specimen in a microscope.",
        answer: "Eyepiece lens"
      },
      {
        type: "short",
        text: "6. What is the recommended material for cleaning microscope lenses?",
        answer: "Lens paper"
      },
      {
        type: "short",
        text: "7. Which mirror is used when the light source is weak?",
        answer: "Concave mirror"
      },
      {
        type: "short",
        text: "8. What is the usual magnification power of a standard eyepiece lens?",
        answer: "10x"
      },
      {
        type: "short",
        text: "9. Draw and label a simple diagram of a compound microscope, marking at least five key parts.",
        answer: "Diagram" // Accept any text, teacher checks later
      },
      {
        type: "short",
        text: "10. List two safety precautions to follow when using a compound microscope in the laboratory.",
        answer: "Precautions" // Accept any text, teacher checks later
      }
    ];

    // --------- Render Questions ---------
    function renderQuestions() {
      const questionsSection = document.getElementById("questionsSection");
      questionsSection.innerHTML = `<h2>Assessment Questions</h2>`;
      questions.forEach((q, idx) => {
        let html = `<div class="question"><label><b>${q.text}</b></label><br>`;
        if(q.type === "mcq") {
          q.options.forEach((opt, oidx) => {
            html += `<input type="radio" name="q${idx}" value="${opt}" required> ${opt}<br>`;
          });
        } else if(q.type === "short") {
          html += `<input type="text" name="q${idx}" required style="width:90%;">`;
        }
        html += `</div>`;
        questionsSection.innerHTML += html;
      });
    }
    renderQuestions();

    // --------- Submission Handler ---------
    document.getElementById("assessmentForm").onsubmit = async function(e) {
      e.preventDefault();
      document.getElementById("errorMsg").textContent = "";
      document.getElementById("resultMsg").textContent = "";

      // Collect answers
      const form = e.target;
      const student = {
        name: form.studentName.value.trim(),
        school: form.schoolName.value.trim(),
        prn: form.prnNumber.value.trim(),
        batch: form.batchNumber.value.trim(),
        email: form.emailId.value.trim()
      };
      const answers = [];
      let allAnswered = true;
      for(let i=0; i<questions.length; i++) {
        let val;
        if(questions[i].type === "mcq") {
          const radios = form[`q${i}`];
          if (!radios) { allAnswered = false; break; }
          if (radios.length) {
            val = Array.from(radios).find(r=>r.checked)?.value || "";
          } else {
            val = radios.checked ? radios.value : "";
          }
        } else {
          val = form[`q${i}`].value.trim();
        }
        if(val === "") allAnswered = false;
        answers.push(val);
      }
      if(!allAnswered) {
        document.getElementById("errorMsg").textContent = "Please answer all questions before submitting.";
        return;
      }
      if(!form.declaration.checked) {
        document.getElementById("errorMsg").textContent = "You must agree to the declaration to submit.";
        return;
      }

      // Calculate marks (accept any answer for diagram/precautions, teacher to check manually)
      let marks = 0;
      for(let i=0; i<questions.length; i++) {
        if(questions[i].type === "mcq" || (questions[i].type === "short" && questions[i].answer !== "Diagram" && questions[i].answer !== "Precautions")) {
          if(answers[i].toLowerCase().trim() === questions[i].answer.toLowerCase().trim()) marks++;
        }
      }
      // Diagram and precautions questions (give 0 now, teacher will review)
      // Total for auto questions: 8, teacher needs to check last 2

      // Save to Google Sheet (via Apps Script web app)
      // --- Replace this URL with your deployed Google Apps Script endpoint ---
      const scriptURL = "https://script.google.com/macros/s/AKfycbz29tU_7YqIqOLCrcRS-b8k5JEqUJxe99ka1QC8f1QyffhyosEHcwWZGTWvNhj4X_u4GA/exec";
      const submission = {
        timestamp: new Date().toISOString(),
        ...student,
        experiment: "Study of Compound Microscope",
        answers: answers,
        marks: marks
      };
      try {
        await fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(submission),
          headers: { "Content-Type": "application/json" }
        });
      } catch(e) {
        // Even if saving fails, show marks
        console.error(e);
      }

      // Show result
      document.getElementById("resultMsg").textContent = `Quiz submitted! You scored ${marks} out of 8 on the auto-graded questions. Your teacher will review the final two questions for additional marks.`;
      document.getElementById("submitBtn").disabled = true;
    };
  </script>
</body>
</html>
